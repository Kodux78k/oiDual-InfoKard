<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Dual.Infodose ¬∑ Activation Panel v4 (Accordion)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-dark: #020406;
      --accent-blue: #4fd4ff;
      --accent-purple: #a855f7;
      --accent-gold: #f59e0b;
      --glass: rgba(6, 10, 18, 0.85);
      --glass-border: rgba(255, 255, 255, 0.08);
      --radius-xl: 40px;
      --radius-lg: 24px;
      --font-main: 'Montserrat', sans-serif;
      --font-mono: 'JetBrains Mono', monospace;
      --ease-elastic: cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

    body {
      margin: 0; padding: 0;
      min-height: 100vh;
      background-color: var(--bg-dark);
      color: #fff;
      font-family: var(--font-main);
      display: flex; align-items: center; justify-content: center;
      overflow: hidden;
      position: relative;
    }

    /* Ambient Background */
    .ambient-glow { position: fixed; inset: 0; z-index: -1; filter: blur(90px); opacity: 0.3; pointer-events: none; }
    .blob { position: absolute; border-radius: 50%; animation: orbit 30s infinite linear; }
    .blob-1 { width: 500px; height: 500px; background: radial-gradient(circle, var(--accent-blue) 0%, transparent 70%); top: -20%; left: -20%; }
    .blob-2 { width: 400px; height: 400px; background: radial-gradient(circle, var(--accent-purple) 0%, transparent 70%); bottom: -10%; right: -10%; animation-duration: 25s; }

    @keyframes orbit {
      0% { transform: translate(0,0) scale(1); }
      50% { transform: translate(40px, 80px) scale(1.1); }
      100% { transform: translate(0,0) scale(1); }
    }

    .container { width: 100%; max-width: 420px; padding: 20px; z-index: 10; }

    /* Main Card */
    .activation-card {
      background: var(--glass);
      backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      padding: 0 24px; /* Padding removido do topo/base para controle fino da sanfona */
      box-shadow: 0 40px 100px rgba(0,0,0,0.9);
      text-align: center;
      position: relative; overflow: hidden;
      transition: all 0.5s var(--ease-elastic);
    }

    /* Header (Sempre vis√≠vel) */
    .card-header-area {
      padding-top: 32px;
      padding-bottom: 24px;
      cursor: pointer;
      position: relative;
    }
    
    .brand-title { 
      font-size: 0.65rem; font-weight: 800; letter-spacing: 4px; 
      color: var(--accent-blue); text-transform: uppercase;
      margin-bottom: 6px; display: block; opacity: 0.8;
    }
    .main-logo {
      font-size: 2rem; font-weight: 300; line-height: 1;
      background: linear-gradient(90deg, #fff, var(--accent-blue));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .main-logo b { font-weight: 800; }

    /* Toggle Icon (Seta) */
    .toggle-btn {
      position: absolute;
      top: 32px;
      right: 0;
      width: 32px; height: 32px;
      display: flex; align-items: center; justify-content: center;
      color: rgba(255,255,255,0.3);
      transition: transform 0.4s ease, color 0.3s;
    }
    .toggle-btn:hover { color: var(--accent-blue); }
    
    /* Estado Colapsado (Rota√ß√£o da Seta) */
    .activation-card.collapsed .toggle-btn {
      transform: rotate(-180deg);
    }

    /* Card Content (√Årea da Sanfona) */
    .card-content {
      max-height: 1200px; /* Altura m√°xima arbitr√°ria para permitir transi√ß√£o */
      opacity: 1;
      overflow: hidden;
      padding-bottom: 32px; /* Padding inferior do card fica aqui dentro */
      transition: max-height 0.6s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease;
    }

    /* Estado Colapsado (Esconde Conte√∫do) */
    .activation-card.collapsed .card-content {
      max-height: 0;
      opacity: 0;
      padding-bottom: 0;
    }

    /* Dynamic Avatar SVG */
    .avatar-container {
      width: 120px; height: 120px; margin: 0 auto 24px;
      position: relative; display: flex; align-items: center; justify-content: center;
    }
    .avatar-ring {
      position: absolute; inset: -10px;
      border: 1px dashed rgba(79, 212, 255, 0.2);
      border-radius: 50%; animation: spin 20s infinite linear;
    }
    .avatar-core {
      width: 100%; height: 100%;
      border-radius: 50%; overflow: hidden;
      box-shadow: 0 0 40px rgba(79, 212, 255, 0.15);
      border: 2px solid rgba(255,255,255,0.05);
      background: #000;
      transition: transform 0.5s var(--ease-elastic);
    }
    .avatar-core svg { width: 100%; height: 100%; display: block; }
    @keyframes spin { 100% { transform: rotate(360deg); } }

    /* Inputs */
    .input-wrapper { position: relative; margin-bottom: 24px; text-align: left; }
    .input-label {
      font-size: 0.7rem; color: rgba(255,255,255,0.4); 
      margin-left: 12px; margin-bottom: 6px; display: block; font-weight: 600;
    }
    .dual-input {
      width: 100%; background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px; padding: 14px 16px;
      font-family: var(--font-main); color: #fff; font-size: 1rem;
      transition: 0.3s;
    }
    .dual-input:focus {
      border-color: var(--accent-blue); background: rgba(255,255,255,0.06);
      box-shadow: 0 0 15px rgba(79, 212, 255, 0.1);
    }
    
    .tick-icon {
      position: absolute; right: 16px; top: 38px;
      color: var(--accent-blue); opacity: 0; transform: scale(0.5);
      transition: all 0.4s var(--ease-elastic); pointer-events: none;
    }
    .tick-icon.valid { opacity: 1; transform: scale(1); }

    /* Bars */
    .status-bars {
      display: flex; justify-content: center; gap: 6px; margin-bottom: 30px;
    }
    .bar {
      width: 100%; height: 3px; background: rgba(255,255,255,0.1);
      border-radius: 2px; position: relative; overflow: hidden;
    }
    .bar::after {
      content: ''; position: absolute; left: 0; top: 0; height: 100%; width: 0;
      background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
      transition: width 0.6s ease;
    }
    .active.bar::after { width: 100%; }

    /* Buttons */
    .btn-activate {
      width: 100%; padding: 18px; border-radius: 16px;
      border: none; cursor: pointer;
      font-family: var(--font-main); font-weight: 800; font-size: 0.9rem;
      text-transform: uppercase; letter-spacing: 1px;
      background: #fff; color: #000;
      box-shadow: 0 10px 30px rgba(255,255,255,0.1);
      transition: all 0.3s var(--ease-elastic); margin-bottom: 12px;
    }
    .btn-activate:hover { transform: translateY(-2px); box-shadow: 0 15px 40px rgba(255,255,255,0.2); }
    .btn-activate:active { transform: scale(0.98); }
    
    .btn-wa {
      width: 100%; padding: 14px; border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.02);
      color: rgba(255,255,255,0.8); font-size: 0.8rem; font-weight: 600;
      cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn-wa:hover { border-color: #25d366; color: #fff; background: rgba(37, 211, 102, 0.1); }

    /* History */
    .recent-list {
      margin-top: 24px; border-top: 1px solid rgba(255,255,255,0.1);
      padding-top: 16px; text-align: left;
    }
    .recent-title { font-size: 0.65rem; text-transform: uppercase; color: rgba(255,255,255,0.4); font-weight: 700; margin-bottom: 10px; }
    .history-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 10px; background: rgba(255,255,255,0.03); border-radius: 12px;
      margin-bottom: 6px; font-size: 0.75rem; color: rgba(255,255,255,0.8);
    }

    /* Overlay */
    .artask-overlay {
      position: absolute; inset: 0; background: #05080f;
      z-index: 20; padding: 30px; text-align: left;
      display: flex; flex-direction: column; justify-content: center;
      transform: translateY(100%); transition: transform 0.5s cubic-bezier(0.7, 0, 0.3, 1);
    }
    .artask-overlay.show { transform: translateY(0); }
    .terminal-text {
      font-family: var(--font-mono); font-size: 0.85rem; line-height: 1.6; color: #a5b4fc;
    }
    .cursor { display: inline-block; width: 8px; height: 16px; background: var(--accent-blue); animation: blink 1s infinite; vertical-align: middle; }
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

  </style>
</head>
<body>

  <div class="ambient-glow">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
  </div>

  <div class="container">
    <div class="activation-card" id="mainCard">

      <!-- Overlay de Ativa√ß√£o (Permanece dentro do card) -->
      <div class="artask-overlay" id="artaskOverlay">
        <div style="font-size:0.7rem; color:var(--accent-blue); font-weight:800; margin-bottom:20px;">SYSTEM.DUAL // OUTPUT</div>
        <div class="terminal-text" id="terminalOutput">
          > Iniciando handshake...<br>
        </div>
        <div style="margin-top:auto; display:flex; gap:10px;">
          <button class="btn-wa" onclick="sendWhatsApp()" style="flex:1; border-color:var(--accent-blue); color:#fff;">ENVIAR COMANDO</button>
          <button class="btn-wa" onclick="closeOverlay()" style="width:50px;">‚úï</button>
        </div>
      </div>

      <!-- Header: √Årea Clic√°vel para Colapsar -->
      <div class="card-header-area" onclick="toggleCard()">
        <div class="brand-header">
          <span class="brand-title">Interface Neural V3</span>
          <div class="main-logo">Dual.<b>Infodose</b></div>
        </div>
        <div class="toggle-btn">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>
        </div>
      </div>

      <!-- Wrapper Sanfonado (Conte√∫do Ocult√°vel) -->
      <div class="card-content">
        
        <!-- Avatar Fractal -->
        <div class="avatar-container">
          <div class="avatar-ring"></div>
          <div class="avatar-core" id="avatarCore"></div>
        </div>

        <!-- Inputs Inteligentes -->
        <div class="input-wrapper">
          <label class="input-label">CODINOME (USU√ÅRIO)</label>
          <input type="text" class="dual-input" id="nameInput" placeholder="Ex: Kodux" maxlength="15" autocomplete="off">
          <svg class="tick-icon" id="tickName" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
        </div>

        <div class="input-wrapper">
          <label class="input-label">IDENTIDADE ASSISTENTE</label>
          <input type="text" class="dual-input" id="assistInput" placeholder="Gerado automaticamente..." readonly style="opacity:0.7; cursor:not-allowed;">
        </div>

        <!-- Barras L√≥gicas 3-6-9 -->
        <div class="status-bars">
          <div class="bar" id="bar-3"></div>
          <div class="bar" id="bar-6"></div>
          <div class="bar" id="bar-9"></div>
        </div>

        <button class="btn-activate" id="btnActivate">ATIVAR SISTEMA</button>
        
        <button class="btn-wa" id="btnReset">
          <span>‚Ü∫</span> REINICIAR SESS√ÉO
        </button>

        <!-- Hist√≥rico -->
        <div class="recent-list" id="recentList">
          <div class="recent-title">Ativa√ß√µes Recentes</div>
          <div id="historyContainer" style="opacity:0.5; font-size:0.7rem;">Nenhum registro no n√∫cleo.</div>
        </div>

      </div> <!-- Fim card-content -->

    </div>
  </div>

  <script>
    // --- State & Config ---
    const STATE = {
      name: '',
      assistant: '',
      history: []
    };
    
    // --- Elements ---
    const els = {
      card: document.getElementById('mainCard'),
      name: document.getElementById('nameInput'),
      assist: document.getElementById('assistInput'),
      avatar: document.getElementById('avatarCore'),
      bars: [document.getElementById('bar-3'), document.getElementById('bar-6'), document.getElementById('bar-9')],
      tick: document.getElementById('tickName'),
      activate: document.getElementById('btnActivate'),
      overlay: document.getElementById('artaskOverlay'),
      terminal: document.getElementById('terminalOutput'),
      history: document.getElementById('historyContainer'),
      reset: document.getElementById('btnReset')
    };

    // --- Accordion Toggle Logic ---
    function toggleCard() {
      els.card.classList.toggle('collapsed');
    }

    // --- Core Logic: Fractal Avatar Generator ---
    function generateAvatar(seed) {
      if(!seed) return '<svg viewBox="0 0 100 100" style="background:#111"><circle cx="50" cy="50" r="20" fill="#333"/></svg>';
      let hash = 0;
      for (let i = 0; i < seed.length; i++) hash = seed.charCodeAt(i) + ((hash << 5) - hash);
      const c1 = `hsl(${Math.abs(hash % 360)}, 70%, 60%)`;
      const c2 = `hsl(${Math.abs((hash + 40) % 360)}, 80%, 50%)`;
      const id = Math.abs(hash);
      return `
        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
          <defs>
            <linearGradient id="grad${id}" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:${c1};stop-opacity:1" />
              <stop offset="100%" style="stop-color:${c2};stop-opacity:1" />
            </linearGradient>
          </defs>
          <rect width="100" height="100" fill="#0b0f19" />
          <path d="M50 50 L${id%100} 0 L100 ${id%80} Z" fill="url(#grad${id})" opacity="0.5" />
          <circle cx="${50 + (hash%20)}" cy="${50 + ((hash>>2)%20)}" r="${20 + (hash%15)}" fill="none" stroke="url(#grad${id})" stroke-width="2" />
          <path d="M0 100 Q 50 ${Math.abs(hash%50)} 100 100" fill="url(#grad${id})" opacity="0.3" />
          <text x="50" y="55" font-family="Arial" font-weight="bold" font-size="24" fill="#fff" text-anchor="middle" dominant-baseline="middle">${seed.substring(0,2).toUpperCase()}</text>
        </svg>
      `;
    }

    // --- Core Logic: UI Updates ---
    function updateUI() {
      const val = els.name.value.trim();
      els.bars[0].classList.toggle('active', val.length >= 3);
      els.bars[1].classList.toggle('active', val.length >= 6);
      els.bars[2].classList.toggle('active', val.length >= 9);
      
      if (val.length >= 2) {
        els.assist.value = `${val} Dual Infodose`;
        els.tick.classList.add('valid');
        els.avatar.innerHTML = generateAvatar(val);
      } else {
        els.assist.value = '';
        els.tick.classList.remove('valid');
        els.avatar.innerHTML = generateAvatar('DEFAULT');
      }
      STATE.name = val;
      STATE.assistant = els.assist.value;
    }

    // --- Persist√™ncia ---
    function saveState() {
      localStorage.setItem('dual_v3_name', STATE.name);
      localStorage.setItem('dual_v3_history', JSON.stringify(STATE.history));
    }

    function loadState() {
      const savedName = localStorage.getItem('dual_v3_name');
      if (savedName) {
        els.name.value = savedName;
        updateUI();
      }
      const savedHist = localStorage.getItem('dual_v3_history');
      if (savedHist) {
        STATE.history = JSON.parse(savedHist);
        renderHistory();
      }
    }

    // --- Artask Workflow ---
    let currentLink = '';

    els.activate.onclick = () => {
      if (!STATE.name) {
        alert("Identifique-se primeiro.");
        return;
      }
      
      // Auto-expandir se estiver fechado ao clicar (caso algo externo dispare)
      els.card.classList.remove('collapsed');

      const msg = `üöÄ *DUAL.INFODOSE ACTIVATION*\n\nüë§ *User:* ${STATE.name}\nü§ñ *Assistant:* ${STATE.assistant}\nüìÖ *Time:* ${new Date().toLocaleTimeString()}\n\n> Comando de Inicializa√ß√£o:\n> *${STATE.name} iniciar protocolo Infodose*`;
      currentLink = `https://wa.me/?text=${encodeURIComponent(msg)}`;

      els.overlay.classList.add('show');
      els.terminal.innerHTML = `> Conectando servidor neural...<br>> Gerando hash de identidade...<br>> <span style="color:#4fd4ff">ARTASK CRIADA</span><br>> Aguardando transmiss√£o...<span class="cursor"></span>`;
      
      addToHistory(new Date().toLocaleTimeString(), "Ativa√ß√£o Geral");
      
      if(window.speechSynthesis) {
        const u = new SpeechSynthesisUtterance(`Artask gerada para ${STATE.name}.`);
        u.lang = 'pt-BR'; u.rate = 1.2;
        window.speechSynthesis.speak(u);
      }
    };

    function sendWhatsApp() {
      window.open(currentLink, '_blank');
      closeOverlay();
    }

    function closeOverlay() {
      els.overlay.classList.remove('show');
    }

    // --- Hist√≥rico Logic ---
    function addToHistory(time, type) {
      STATE.history.unshift({ time, type });
      if (STATE.history.length > 3) STATE.history.pop();
      saveState();
      renderHistory();
    }

    function renderHistory() {
      if (STATE.history.length === 0) return;
      els.history.innerHTML = '';
      STATE.history.forEach(item => {
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `<span><b>${item.time}</b> ‚Äî ${item.type}</span><span style="color:#4fd4ff">‚úì</span>`;
        els.history.appendChild(div);
      });
    }

    els.reset.onclick = () => {
      if(confirm('Reiniciar sistema e limpar dados locais?')) {
        localStorage.removeItem('dual_v3_name');
        localStorage.removeItem('dual_v3_history');
        location.reload();
      }
    };

    // --- Init ---
    els.name.addEventListener('input', () => { updateUI(); saveState(); });
    els.avatar.innerHTML = generateAvatar('INIT');
    loadState();

  </script>
</body>
</html>

